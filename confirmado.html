<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Compra Confirmada | Views</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="confirmation-hero">

  <!-- Logo -->
  <img src="images/logo.png" alt="Logo Views" class="logo">

  <!-- Mensaje -->
  <h1 class="confirmation-title">‚úÖ ¬°Compra Confirmada!</h1>
  <p class="confirmation-text">
    Gracias por comprar tu ticket para <strong>Views</strong>.<br>
    Tu pago fue procesado correctamente y tu espacio en el evento est√° reservado.
  </p>
  <p class="confirmation-text">
    üì© Hemos enviado un comprobante a tu correo electr√≥nico.<br>
    Nos vemos pronto üöÄ
  </p>

  <!-- QR din√°mico -->
  <div class="qr-section" id="qrContainer" style="display:none;">
    <h3>Escanea tu c√≥digo QR para ingresar al evento</h3>
    <div id="qrCode"></div>
    <button id="downloadQR" class="download-button">üì• Descargar QR</button>
    <button id="downloadPDF" class="download-button">üìÑ Descargar Ticket en PDF</button>
  </div>

  <!-- Bot√≥n para volver -->
  <a href="index.html">
    <button class="back-button">Volver a la p√°gina principal</button>
  </a>

</div>

<footer class="footer">
  <p>¬© 2026 Views. Todos los derechos reservados.</p>
</footer>

<!-- Librer√≠as -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const params = new URLSearchParams(window.location.search);
  const ticketID = params.get("ticket"); 

  if(ticketID){
    const qrContainer = document.getElementById("qrContainer");
    qrContainer.style.display = "block";

    const ticketURL = `https://tu-sitio.com/tickets/${ticketID}`;

    // Generar QR
    const qr = new QRCode(document.getElementById("qrCode"), {
      text: ticketURL,
      width: 220,
      height: 220,
      colorDark : "#0e0e0e",
      colorLight : "#ffffff",
      correctLevel : QRCode.CorrectLevel.H
    });

    // Descargar QR
    document.getElementById("downloadQR").addEventListener("click", function(){
      const qrCanvas = document.querySelector("#qrCode canvas");
      if(!qrCanvas) return;
      const link = document.createElement("a");
      link.href = qrCanvas.toDataURL("image/png");
      link.download = `ticket-${ticketID}.png`;
      link.click();
    });

    // Descargar ticket en PDF con dise√±o profesional
    document.getElementById("downloadPDF").addEventListener("click", function(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: "portrait",
        unit: "pt",
        format: [350, 500]
      });

      // Fondo negro
      doc.setFillColor(14,14,14);
      doc.rect(0,0,350,500,'F');

      // Borde naranja
      doc.setDrawColor(255,106,0);
      doc.setLineWidth(4);
      doc.rect(10,10,330,480);

      // Logo
      const logo = new Image();
      logo.src = "images/logo.png";
      logo.onload = () => {
        doc.addImage(logo,'PNG',125,20,100,40);

        // T√≠tulo
        doc.setFontSize(18);
        doc.setTextColor(255,106,0);
        doc.setFont("helvetica","bold");
        doc.text("TICKET VIEWS",175,80,null,null,'center');

        // Texto info
        doc.setFontSize(12);
        doc.setTextColor(255,255,255);
        doc.setFont("helvetica","normal");
        doc.text(`ID de Ticket: ${ticketID}`,175,110,null,null,'center');
        doc.text("Evento audiovisual creativo",175,130,null,null,'center');
        doc.text("üìÖ Fecha: Pr√≥ximamente",175,150,null,null,'center');
        doc.text("üìç Lugar: Por confirmar",175,170,null,null,'center');

        // QR
        const qrCanvas = document.querySelector("#qrCode canvas");
        const qrDataURL = qrCanvas.toDataURL("image/png");
        doc.addImage(qrDataURL,'PNG',115,200,120,120);

        // Footer del ticket
        doc.setFontSize(10);
        doc.setTextColor(255,106,0);
        doc.text("¬© 2026 Views",175,340,null,null,'center');

        doc.save(`ticket-${ticketID}.pdf`);
      };
    });

  } else {
    document.getElementById("qrContainer").innerHTML = "<p style='color:#ff6a00;'>‚ö†Ô∏è No se pudo generar el QR. Pago no confirmado.</p>";
  }
</script>
